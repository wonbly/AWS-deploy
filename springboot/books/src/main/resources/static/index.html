<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="globals.css" />
    <link rel="stylesheet" href="style.css" />
    <title>교보문고 리스트 - 데이터 연동 완결판</title>
  </head>
  <body>
    <div class="slide" id="book-list-container"></div>

    <template id="book-template">
      <div class="frame">
        <div class="div">
          <div class="frame-wrapper">
            <div class="frame-2">
              <div class="rectangle"></div>
              <div class="div-wrapper">
                <div class="frame-3">
                  <a href="#" style="display:block;"><div class="frame-4"><div class="text-wrapper">새창보기</div></div></a>
                  <a href="#" style="display:block;"><div class="frame-6"><div class="text-wrapper">미리보기</div></div></a>
                </div>
              </div>
            </div>
          </div>
          <div class="frame-7">
            <div class="frame-8"><p class="p"></p></div>
            <div class="frame-9">
              <div class="text-wrapper-2 author-1"></div>
              <div class="text-wrapper-2">·</div>
              <div class="text-wrapper-2 author-2"></div>
              <div class="text-wrapper-2">·</div>
              <div class="text-wrapper-3 publish-date"></div>
            </div>
            <div class="frame-8"><p class="text-wrapper-4 description"></p></div>
            <div class="frame-10">
              <div class="text-wrapper-5 discount"></div>
              <p class="element"><span class="span price"></span>원</p>
              <div class="text-wrapper-7 original-price"></div>
              <div class="text-wrapper-8">|</div>
              <div class="text-wrapper-9 point"></div>
            </div>
            <div class="frame-11">
              <div class="text-wrapper-10">★</div>
              <div class="text-wrapper-11 rating"></div>
            </div>
          </div>
        </div>
        <div class="frame-12">
          <div class="frame-13">
            <div class="text-wrapper-12 delivery-date"></div>
            <div class="text-wrapper-13 delivery-status"></div>
          </div>
        </div>
        <div class="frame-14">
          <div class="frame-15">
            <a href="#" style="display:block; width:100%;">
              <div class="frame-16"><div class="text-wrapper-14">장바구니</div></div>
            </a>
          </div>
          <a href="#" style="display:block; width:100%;">
            <div class="frame-17"><div class="text-wrapper-15">바로구매</div></div>
          </a>
        </div>
      </div>
    </template>

    <script>
      async function loadBookData() {
        try {
          const response = await fetch("/api/books");
          const books = await response.json();
          const container = document.querySelector("#book-list-container");
          const template = document.querySelector("#book-template");

          container.innerHTML = ""; 

          books.forEach((book) => {
            const clone = template.content.cloneNode(true);

            clone.querySelector(".p").innerText = book.title;
            clone.querySelector(".author-1").innerText = book.author;
            clone.querySelector(".author-2").innerText = book.author;
            clone.querySelector(".publish-date").innerText = book.publishDate;
            clone.querySelector(".description").innerText = book.description;

            clone.querySelector(".price").innerText = book.price.toLocaleString();
            clone.querySelector(".original-price").innerText = book.originalPrice.toLocaleString() + "원";
            clone.querySelector(".discount").innerText = book.discountRate + "%";
            clone.querySelector(".point").innerText = book.point.toLocaleString() + "p";
            
            // 평점 디테일: 무조건 5.0 처럼 소수점 1자리 고정
            clone.querySelector(".rating").innerText = Number(book.rating).toFixed(1);

            const parts = book.deliveryDate ? book.deliveryDate.split(" ") : ["", ""];
            clone.querySelector(".delivery-date").innerText = parts[0];
            clone.querySelector(".delivery-status").innerText = parts[1] || "출고예정";

            const thumb = clone.querySelector(".rectangle");
            thumb.style.backgroundImage = `url('${book.imageUrl}')`;
            
            container.appendChild(clone);
          });
        } catch (error) {
          console.error("데이터 로드 실패:", error);
        }
      }
      window.onload = loadBookData;
    </script>
  </body>
</html>